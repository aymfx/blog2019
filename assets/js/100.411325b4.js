(window.webpackJsonp=window.webpackJsonp||[]).push([[100],{612:function(a,t,s){"use strict";s.r(t);var e=s(6),r=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("blockquote",[s("p",[a._v("node.js深入浅出笔记")])]),a._v(" "),s("h1",{attrs:{id:"内存的控制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#内存的控制"}},[a._v("#")]),a._v(" 内存的控制")]),a._v(" "),s("blockquote",[s("p",[a._v("node毕竟是在v8上跑的服务，v8的内存管理机制，在浏览器使用起来绰绰有余，但是对于node确有限制，对内存的需求还是很大的，但是浏览器能分配的内存不是很大，所以还是有些局限性")])]),a._v(" "),s("h2",{attrs:{id:"查看node内存的信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看node内存的信息"}},[a._v("#")]),a._v(" 查看node内存的信息")]),a._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("memoryUsage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" rss"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("21295104")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  heapTotal"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8425472")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  heapUsed"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3987064")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  external"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8942")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//heapTotal申请的总堆内存")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//heapUsed 当前使用量")]),a._v("\n\n")])])]),s("h2",{attrs:{id:"v8提供了调整内存大小的命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#v8提供了调整内存大小的命令"}},[a._v("#")]),a._v(" v8提供了调整内存大小的命令")]),a._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//两者选其一")]),a._v("\n    node "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("max"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("old"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("space"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("size"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1700")]),a._v(" test"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("js\n    node "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("max"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("space"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("size"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1024")]),a._v(" test"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("js\n\n")])])]),s("h2",{attrs:{id:"v8的垃圾回收机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#v8的垃圾回收机制"}},[a._v("#")]),a._v(" v8的垃圾回收机制")]),a._v(" "),s("blockquote",[s("p",[a._v("v8的内存分代图")])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://aymfx.github.io/img/a20170904/a1.png",alt:"流程图"}})]),a._v(" "),s("blockquote",[s("p",[a._v("node --max-old-space-size 用于设置老生带最大值")])]),a._v(" "),s("blockquote",[s("p",[a._v("node --max-new-space-size用于设置新生代最大值")])]),a._v(" "),s("blockquote",[s("p",[a._v("在不设置内存的情况默认 老生代默认64位约1400mb 32位约700mb")])]),a._v(" "),s("blockquote",[s("p",[a._v("如图所示 源代码")])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://aymfx.github.io/img/a20170904/a2.png",alt:"流程图"}})]),a._v(" "),s("blockquote",[s("p",[a._v("对于新生代,它由两个 reserved_semispace_size所组成,一个reserved_semispace_size 的64位约16m，32位约8m。")])]),a._v(" "),s("blockquote",[s("p",[a._v("下图就可以解释 v8堆内存在64位上有1464mb,在32位上有732mb")])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://aymfx.github.io/img/a20170904/a3.png",alt:"流程图"}})]),a._v(" "),s("blockquote",[s("p",[a._v("Scavenge算法")])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://aymfx.github.io/img/a20170904/a4.png",alt:"流程图"}})]),a._v(" "),s("blockquote",[s("p",[a._v("当一个对象经过多次复制依然存活时，它将会被认为是生命周期较长的对象，这种较长生命周期的对象随后会被移动到老生代中，这种过程叫做晋升")])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://aymfx.github.io/img/a20170904/a5.png",alt:"流程图"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://aymfx.github.io/img/a20170904/a6.png",alt:"流程图"}})]),a._v(" "),s("blockquote",[s("p",[a._v("老生代处理的算法  懵逼了 Mark-Sweep & Mark-Compact")])]),a._v(" "),s("ul",[s("li",[a._v("看看书，先带过")])]),a._v(" "),s("blockquote",[s("p",[a._v("用命令行查看垃圾回收日志")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("\nnode --trace_gc -e "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'var a=[];for(var i=0;i<1000000;i++) a.push(new Array(100));'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" gc.log\n\n")])])]),s("blockquote",[s("p",[a._v("通过分析垃圾回收日志，可以了解垃圾回收的运行状况，找出那些阶段比较耗时")])]),a._v(" "),s("blockquote",[s("p",[a._v("使用--prof参数，可以分析v8执行的性能以及垃圾回收所占用的时间")])]),a._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//app.js")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("var")]),a._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("i"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000000")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("i"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("var")]),a._v(" a"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n")])])]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("\n node --prof app.js //运行\n\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);