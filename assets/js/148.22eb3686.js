(window.webpackJsonp=window.webpackJsonp||[]).push([[148],{667:function(t,s,e){"use strict";e.r(s);var a=e(6),r=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("blockquote",[e("p",[t._v("想学习下 nodejs 服务器的搭建全过程，毕竟这也是迈向后端的一大步，用的是 centos 服务器需要实现 nodejs 环境配置 nginx 反向代理 mysql 的环境配置及使用 express 服务器的使用,防火墙的策略开关")])]),t._v(" "),e("h2",{attrs:{id:"创建-ssh"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建-ssh"}},[t._v("#")]),t._v(" 创建 ssh")]),t._v(" "),e("blockquote",[e("p",[t._v("https://cloud.tencent.com/developer/article/1157620")])]),t._v(" "),e("h2",{attrs:{id:"安装-node"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装-node"}},[t._v("#")]),t._v(" 安装 node")]),t._v(" "),e("ol",[e("li",[t._v("安装 git")])]),t._v(" "),e("blockquote",[e("p",[t._v("yum install git -y")])]),t._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[t._v("安装 nvm 服务，这个是用来管理 node 版本的工具，可以在服务器上切换不同的 node 环境")])]),t._v(" "),e("blockquote",[e("p",[t._v("curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.9/install.sh | bash")])]),t._v(" "),e("p",[t._v("注：安装 nvm 后如果是使用 xshell 等工具连接服务器，则需要重新连接一次，不然会提示没有 nvm")]),t._v(" "),e("ol",{attrs:{start:"3"}},[e("li",[t._v("使用 nvm 进行安装 nodejs")])]),t._v(" "),e("blockquote",[e("p",[t._v("nvm install vxxxx xxx 表示版本")])]),t._v(" "),e("ol",{attrs:{start:"4"}},[e("li",[t._v("如果没有自动启用当前下载的版本，使用下面命令")])]),t._v(" "),e("blockquote",[e("p",[t._v("nvm use vxxx")])]),t._v(" "),e("ol",{attrs:{start:"5"}},[e("li",[t._v("当然如果要是没有自动配置成默认的 node 版本的话，执行下面命令")])]),t._v(" "),e("blockquote",[e("p",[t._v("nvm alias default vxxx")])]),t._v(" "),e("ol",{attrs:{start:"6"}},[e("li",[t._v("使用淘宝源安装最新的 npm")])]),t._v(" "),e("blockquote",[e("p",[t._v("npm install -g cnpm --registry=https://registry.npm.taobao.org")])]),t._v(" "),e("h2",{attrs:{id:"nginx-配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置"}},[t._v("#")]),t._v(" nginx 配置")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("cd /usr/local")])]),t._v(" "),e("li",[e("p",[t._v("运行以下命令安装 PCRE 和 zlib 库。")])])]),t._v(" "),e("blockquote",[e("p",[t._v("yum -y install pcre pcre-devel zlib-devel")])]),t._v(" "),e("ol",{attrs:{start:"3"}},[e("li",[t._v("下载 Nginx")])]),t._v(" "),e("blockquote",[e("p",[t._v("wget http://nginx.org/download/nginx-1.12.2.tar.gz")])]),t._v(" "),e("ol",{attrs:{start:"4"}},[e("li",[t._v("解压安装包")])]),t._v(" "),e("blockquote",[e("p",[t._v("tar -xvzf nginx-1.12.2.tar.gz")])]),t._v(" "),e("ol",{attrs:{start:"5"}},[e("li",[t._v("下载 OpenSSL")])]),t._v(" "),e("blockquote",[e("p",[t._v("wget https://www.openssl.org/source/openssl-1.1.0g.tar.gz")])]),t._v(" "),e("ol",{attrs:{start:"6"}},[e("li",[t._v("解压安装包")])]),t._v(" "),e("blockquote",[e("p",[t._v("tar -xvzf openssl-1.1.0g.tar.gz")])]),t._v(" "),e("ol",{attrs:{start:"7"}},[e("li",[e("p",[t._v("cd nginx-1.12.2")])]),t._v(" "),e("li",[e("p",[t._v("执行下列命令")])])]),t._v(" "),e("div",{staticClass:"language-vim extra-class"},[e("pre",{pre:!0,attrs:{class:"language-vim"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("configure "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("prefix"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("with"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("http_stub_status_module "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("with"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("http_gzip_static_module "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("with"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("http_ssl_module "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("with"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("openssl"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("openssl"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("0g\n")])])]),e("p",[t._v("报错:./configure: error: C compiler cc is not found")]),t._v(" "),e("blockquote",[e("p",[t._v("yum install gcc")])]),t._v(" "),e("blockquote",[e("p",[t._v("继续安装")])]),t._v(" "),e("div",{staticClass:"language-vim extra-class"},[e("pre",{pre:!0,attrs:{class:"language-vim"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("make")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("make")]),t._v(" install\n")])])]),e("ol",{attrs:{start:"9"}},[e("li",[t._v("生成证书")])]),t._v(" "),e("blockquote",[e("p",[t._v("openssl req -new -x509 -nodes -out server.crt -keyout server.key")])]),t._v(" "),e("div",{staticClass:"language-nginx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-nginx"}},[e("code",[e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v(" www.ldyldy.cn")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#填写绑定证书的域名")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_certificate")]),t._v(" 1_www.ldyldy.com_bundle.crt")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_certificate_key")]),t._v(" 2_www.ldyldy.com.key")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_session_timeout")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("5m")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_protocols")]),t._v(" TLSv1 TLSv1.1 TLSv1.2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#按照这个协议配置")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_ciphers")]),t._v(" ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#按照这个套件配置")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_prefer_server_ciphers")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v("   html")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#站点目录")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v("  index.html index.htm")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h2",{attrs:{id:"添加防火墙配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#添加防火墙配置"}},[t._v("#")]),t._v(" 添加防火墙配置")]),t._v(" "),e("p",[t._v("查看防火墙状态是否开启")]),t._v(" "),e("blockquote",[e("p",[t._v("firewall-cmd --state")])]),t._v(" "),e("p",[t._v("启动服务")]),t._v(" "),e("blockquote",[e("p",[t._v("systemctl start firewalld")])]),t._v(" "),e("p",[t._v("设为开机启动")]),t._v(" "),e("blockquote",[e("p",[t._v("systemctl enable firewalld")])]),t._v(" "),e("p",[t._v("查看端口列表")]),t._v(" "),e("blockquote",[e("p",[t._v("firewall-cmd --permanent --list-port")])]),t._v(" "),e("p",[t._v("添加防火墙端口号")]),t._v(" "),e("blockquote",[e("p",[t._v("firewall-cmd --permanent --zone=public --add-port=80/tcp")])]),t._v(" "),e("p",[t._v("移除防火墙端口号")]),t._v(" "),e("blockquote",[e("p",[t._v("firewall-cmd --permanent --zone=public --remove-port=80/tcp")])]),t._v(" "),e("p",[t._v("重启")]),t._v(" "),e("blockquote",[e("p",[t._v("firewall-cmd --reload")])]),t._v(" "),e("p",[t._v("命令含义：")]),t._v(" "),e("div",{staticClass:"language-nginx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-nginx"}},[e("code",[t._v("--zone "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#作用域")]),t._v("\n\n--add-port=80/tcp  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#添加端口，格式为：端口/通讯协议")]),t._v("\n\n--permanent   "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#永久生效，没有此参数重启后失效")]),t._v("\n")])])]),e("p",[t._v("查看防火墙状态")]),t._v(" "),e("blockquote",[e("p",[t._v("systemctl status firewalld.service")])]),t._v(" "),e("p",[t._v("启动防火墙")]),t._v(" "),e("blockquote",[e("p",[t._v("systemctl start firewalld.service")])]),t._v(" "),e("p",[t._v("关闭防火墙")]),t._v(" "),e("blockquote",[e("p",[t._v("systemctl stop firewalld.service")])]),t._v(" "),e("p",[t._v("重新启动防火墙")]),t._v(" "),e("blockquote",[e("p",[t._v("systemctl restart firewalld.service")])]),t._v(" "),e("p",[t._v("查看端口占用")]),t._v(" "),e("blockquote",[e("p",[t._v("lsof -i:8080")])])])}),[],!1,null,null,null);s.default=r.exports}}]);